<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Detalles del M√≥dulo N¬∞ {{ moduloId }}</ion-title>
    <app-theme-toggle slot="end"></app-theme-toggle>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="modulo">
  <ion-card class="device-detail-card">
    <!-- T√≠tulo del m√≥dulo encima de las columnas -->
    <ion-card-header>
      <ion-card-title class="modulo-titulo">
        M√≥dulo {{ modulo.ubicacion }} #{{ modulo.moduloId }}
      </ion-card-title>
    </ion-card-header>

    <ion-grid>
      <ion-row>
        <!-- Informaci√≥n a la izquierda -->
        <ion-col size="12" size-md="6">
          <ion-card-content class="info-izquierda">
            <!-- Estado del Reset -->
            <div class="estado-section">
              <h4>Estado:</h4>
              <ng-container *ngIf="estadoReset !== null; else cargandoReset">
                <ion-chip [color]="estadoReset ? 'success' : 'danger'">
                  {{ estadoReset ? 'Encendido' : 'Apagado' }}
                </ion-chip>
              </ng-container>
              <ng-template #cargandoReset>
                <ion-chip color="warning">Cargando estado...</ion-chip>
              </ng-template>
            </div>

            <!-- Valores UP y DOWN -->
            <div class="valores-section">
              <h4>Apunte Actual:</h4>
              <div class="valores-container">
                <div class="valor-item">
                  <span class="valor-label">UP:</span>
                  <span class="valor-dato">{{ ultimoApunte?.up }}</span>
                </div>
                <div class="valor-item">
                  <span class="valor-label">DOWN:</span>
                  <span class="valor-dato">{{ ultimoApunte?.down }}</span>
                </div>
              </div>
            </div>

            <!-- √öltimas Mediciones -->
            <div class="mediciones-section">
              <h4>√öltimas Mediciones:</h4>
              
              <!-- Temperatura -->
              <div class="medicion-item temperatura-item">
                <div class="medicion-header">
                  <span class="medicion-tipo">Temperatura:</span>
                </div>
                <ng-container *ngIf="ultimaMedicion">
                  <p class="medicion-valor">{{ ultimaMedicion.valor_temp }} ¬∞C</p>
                  <p class="medicion-fecha">{{ ultimaMedicion.fecha | date: 'dd/MM/yyyy HH:mm' }}</p>
                </ng-container>
                <ng-template #noMedicionTemp>
                  <p class="no-medicion">No disponible</p>
                </ng-template>
              </div>

              <!-- Presi√≥n -->
              <div class="medicion-item presion-item">
                <div class="medicion-header">
                  <span class="medicion-tipo">Presi√≥n:</span>
                </div>
                <ng-container *ngIf="ultimaMedicion">
                  <p class="medicion-valor">{{ ultimaMedicion.valor_press }} bar</p>
                  <p class="medicion-fecha">{{ ultimaMedicion.fecha | date: 'dd/MM/yyyy HH:mm' }}</p>
                </ng-container>
                <ng-template #noMedicionPres>
                  <p class="no-medicion">No disponible</p>
                </ng-template>
              </div>

              <div class="sistema-info-section">
                <h4>Informaci√≥n del Sistema:</h4>
                <div class="sistema-items">
                  <div class="sistema-item">
                    <span class="sistema-label">üß† Memoria Libre:</span>
                    <span class="sistema-valor"> {{ modulo.memoriaLibre || 'N/A' }} KB</span>
                  </div>
                  <div class="sistema-item">
                    <span class="sistema-label">üî• Temp. Interna:</span>
                    <span class="sistema-valor"> {{ modulo.temperaturaInterna || 'N/A' }} ¬∞C</span>
                  </div>
                  <div class="sistema-item">
                    <span class="sistema-label">‚ö° Voltaje:</span>
                    <span class="sistema-valor"> {{ modulo.voltajeAlimentacion || 'N/A' }} V</span>
                  </div>
                </div>
              </div>
            </div>
          </ion-card-content>
        </ion-col>

        <!-- Imagen y versi√≥n a la derecha -->
        <ion-col size="12" size-md="6" class="device-image-section">
          <div class="imagen-container">
            <img [src]="estadoReset ? 'assets/img/version2.png' : 'assets/img/version1.png'" 
                 alt="Imagen m√≥dulo" 
                 class="device-image"/>
            <div class="version-info">
              <ion-chip color="tertiary">
                <ion-label>{{ modulo.version || 'Versi√≥n 1.0' }}</ion-label>
              </ion-chip>
            </div>
          </div>
          <div class="info-tecnica-section">
            <div class="info-tecnica-item">
              <span class="info-label">üåê IP:</span>
              <span class="info-valor"> {{ modulo.direccionIP || 'N/A' }}</span>
            </div>
            <div class="info-tecnica-item">
              <span class="info-label">üíæ Firmware:</span>
              <span class="info-valor"> {{ modulo.firmware || 'N/A' }}</span>
            </div>
            <div class="info-tecnica-item">
              <span class="info-label">üè∑Ô∏è MAC:</span>
              <span class="info-valor"> {{ modulo.direccionMAC || 'N/A' }}</span>
            </div>
          </div>
        </ion-col>
      </ion-row>

      <!-- Botones de Reset debajo de las columnas -->
      <ion-row>
        <ion-col size="12">
          <div class="botones-reset">
            <ion-button expand="block" 
                       color="success" 
                       (click)="abrirReset(modulo.moduloId)"
                       [disabled]="estadoReset === true">
              Encender m√≥dulo
            </ion-button>
            <ion-button expand="block" 
                       color="danger" 
                       (click)="cerrarReset(modulo.moduloId)"
                       [disabled]="estadoReset === false">
              Apagar m√≥dulo
            </ion-button>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-card>

  <!-- Botones principales fuera de la tarjeta -->
  <div class="botones-principales">
    <ion-button expand="block" 
               color="primary" 
               (click)="verHistorialApuntes()"
               class="boton-principal">
      üìù Historial Apuntes
    </ion-button>
    
    <ion-button expand="block" 
               fill="outline" 
               color="medium" 
               (click)="volverAlHome()"
               class="boton-principal">
      üè†Home
    </ion-button>
    
    <ion-button expand="block" 
               color="primary" 
               (click)="verMediciones()"
               class="boton-principal">
      üìä Historial Mediciones
    </ion-button>
  </div>
</ion-content>