<!-- src/app/home/home.page.html - COMPLETO -->
<ion-header>
  <ion-toolbar color="primary">
    <ion-title class="ion-text-center">Módulos de ABS</ion-title>
    <app-theme-toggle slot="end"></app-theme-toggle>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Navegación para tablet/móvil -->
  <div class="navegacion-cuadrantes" *ngIf="mostrarNavegacion">
    <ion-button 
      fill="clear" 
      class="nav-button" 
      [class.active]="cuadranteActivo === 'norte'"
      (click)="cambiarCuadrante('norte')">
      <span class="badge" >N</span>
    </ion-button>
    <ion-button 
      fill="clear" 
      class="nav-button"
      [class.active]="cuadranteActivo === 'este'" 
      (click)="cambiarCuadrante('este')">
      <span class="badge" >E</span>
    </ion-button>
    <ion-button 
      fill="clear" 
      class="nav-button"
      [class.active]="cuadranteActivo === 'oeste'" 
      (click)="cambiarCuadrante('oeste')">
      <span class="badge">O</span>
    </ion-button>
    <ion-button 
      fill="clear" 
      class="nav-button"
      [class.active]="cuadranteActivo === 'sur'" 
      (click)="cambiarCuadrante('sur')">
      <span class="badge">S</span>
    </ion-button>
  </div>

  <div class="cuadrantes-container">
    <!-- CUADRANTE NORTE -->
    <div class="cuadrante cuadrante-norte" 
    [class.cuadrante-activo]="esCuadranteActivo('norte')"
    [style.display]="esCuadranteActivo('norte') ? 'block' : 'none'">
      <h3>Cuadrante Norte</h3>
      <ion-grid class="cuadrante-grid">
        <ion-row>
          <ion-col size="6" size-md="6" size-lg="3" *ngFor="let modulo of getModulosNorte()">
            <ion-card class="modulo-card">
              <img [src]="modulo.estadoReset 
                        ? 'assets/img/version2.png' 
                        : 'assets/img/version1.png'"  
                    alt="Modulo"/>
              <ion-card-header>
                <div class="titulo-con-controles">
                  <ion-button 
                    fill="outline"
                    size="small" 
                    (click)="actualizarEstadoModulo(modulo.moduloId)"
                    class="boton-actualizar"
                    [disabled]="modulo.actualizandoEstado"
                    slot="icon-only">
                    F5
                  </ion-button>
                  <div class="titulo-central">
                    <ion-card-title>{{ modulo.nombre }}</ion-card-title>
                    <ion-card-subtitle>Versión: {{ modulo.version || 'V1' }}</ion-card-subtitle>
                  </div>
                  <div class="indicador-estado" 
                       [class.online]="getEstadoConexion(modulo.moduloId) === 'ONLINE'"
                       [class.offline]="getEstadoConexion(modulo.moduloId) === 'OFFLINE'"
                       [class.timeout]="getEstadoConexion(modulo.moduloId) === 'TIMEOUT'"
                       [class.desconocido]="getEstadoConexion(modulo.moduloId) === 'DESCONOCIDO'"
                       [attr.title]="getTituloEstado(modulo.moduloId)">
                    <ion-icon name="radio-button-on"></ion-icon>
                  </div>
                </div>
              </ion-card-header>
              <ion-card-content>
                <div class="card-body">
                  <!-- Información del modulo a la izquierda -->
                  <div class="modulo-info-left">
                    <div class="info-item">
                      <div class="value">{{ modulo.medicionTempActual || 'N/A' }} °C</div>
                      <div class="value">{{ modulo.medicionPressActual || 'N/A' }} hPa</div>
                    </div>
                  </div>

                  <!-- Mediciones a la derecha -->
                  <div class="mediciones-right">
                    <!-- modulo UP -->
                    <div class="modulo-item up" 
                      [class.activo]="modulo.estadoReset"
                      [class.correcto]="getEstadoApunte(modulo.moduloId, 'up') === 'correcto'"
                         [class.mismatch]="getEstadoApunte(modulo.moduloId, 'up') === 'mismatch'"
                         [class.desconectado]="getEstadoApunte(modulo.moduloId, 'up') === 'desconectado'">
                      <div class="medicion-container">
                        <span class="temperatura">UP: {{ modulo.up }}</span>
                      </div>
                    </div>

                    <!-- modulo DOWN -->
                    <div class="modulo-item down" 
                      [class.activo]="modulo.estadoReset"
                      [class.correcto]="getEstadoApunte(modulo.moduloId, 'down') === 'correcto'"
                         [class.mismatch]="getEstadoApunte(modulo.moduloId, 'down') === 'mismatch'"
                         [class.desconectado]="getEstadoApunte(modulo.moduloId, 'down') === 'desconectado'">
                      <div class="medicion-container">
                        <span class="temperatura">DW: {{ modulo.down }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="botones">
                  <ion-button fill="outline" size="small" 
                  (click)="verMediciones(modulo.moduloId)">
                    DATA
                  </ion-button>
                  <ion-button color="primary" size="small" 
                  (click)="verDetalle(modulo.moduloId)">
                    INFO
                  </ion-button>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>  
      </ion-grid>
    </div>
    
    <!-- CUADRANTE ESTE -->
    <div class="cuadrante cuadrante-este" 
    [class.cuadrante-activo]="esCuadranteActivo('este')"
    [style.display]="esCuadranteActivo('este') ? 'block' : 'none'">
      <h3>Cuadrante Este</h3>
      <ion-grid class="cuadrante-grid">
        <ion-row>
          <ion-col size="6" size-md="6" size-lg="3" *ngFor="let modulo of getModulosEste()">
            <ion-card class="modulo-card">
              <img [src]="modulo.estadoReset 
                        ? 'assets/img/version2.png' 
                        : 'assets/img/version1.png'"  
                    alt="Modulo"/>
              <ion-card-header>
                <div class="titulo-con-controles">
                  <ion-button 
                    fill="outline"
                    size="small" 
                    (click)="actualizarEstadoModulo(modulo.moduloId)"
                    class="boton-actualizar"
                    [disabled]="modulo.actualizandoEstado"
                    slot="icon-only">
                    F5
                  </ion-button>
                  <div class="titulo-central">
                    <ion-card-title>{{ modulo.nombre }}</ion-card-title>
                    <ion-card-subtitle>Versión: {{ modulo.version || 'V1' }}</ion-card-subtitle>
                  </div>
                  <div class="indicador-estado" 
                       [class.online]="getEstadoConexion(modulo.moduloId) === 'ONLINE'"
                       [class.offline]="getEstadoConexion(modulo.moduloId) === 'OFFLINE'"
                       [class.timeout]="getEstadoConexion(modulo.moduloId) === 'TIMEOUT'"
                       [class.desconocido]="getEstadoConexion(modulo.moduloId) === 'DESCONOCIDO'"
                       [attr.title]="getTituloEstado(modulo.moduloId)">
                    <ion-icon name="radio-button-on"></ion-icon>
                  </div>
                </div>
                
              </ion-card-header>
              <ion-card-content>
                <div class="card-body">
                  <div class="modulo-info-left">
                    <div class="info-item">
                      <div class="value">{{ modulo.medicionTempActual || 'N/A' }} °C</div>
                      <div class="value">{{ modulo.medicionPressActual || 'N/A' }} hPa</div>
                    </div>
                  </div>
                  <div class="mediciones-right">
                    <div class="modulo-item up" 
                    [class.activo]="modulo.estadoReset"
                    [class.correcto]="getEstadoApunte(modulo.moduloId, 'up') === 'correcto'"
                         [class.mismatch]="getEstadoApunte(modulo.moduloId, 'up') === 'mismatch'"
                         [class.desconectado]="getEstadoApunte(modulo.moduloId, 'up') === 'desconectado'">
                      <div class="medicion-container">
                        <span class="temperatura">UP: {{ modulo.up }}</span>
                      </div>
                    </div>
                    <div class="modulo-item down" 
                    [class.activo]="modulo.estadoReset"
                    [class.activo]="modulo.estadoReset"
                         [class.correcto]="getEstadoApunte(modulo.moduloId, 'down') === 'correcto'"
                         [class.mismatch]="getEstadoApunte(modulo.moduloId, 'down') === 'mismatch'"
                         [class.desconectado]="getEstadoApunte(modulo.moduloId, 'down') === 'desconectado'">
                      <div class="medicion-container">
                        <span class="temperatura">DW: {{ modulo.down }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="botones">
                  <ion-button fill="outline" size="small" 
                  (click)="verMediciones(modulo.moduloId)">
                    DATA
                  </ion-button>
                  <ion-button color="primary" size="small" 
                  (click)="verDetalle(modulo.moduloId)">
                    INFO
                  </ion-button>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>  
      </ion-grid>
    </div>

    <!-- CUADRANTE OESTE -->
    <div class="cuadrante cuadrante-oeste" 
    [class.cuadrante-activo]="esCuadranteActivo('oeste')"
    [style.display]="esCuadranteActivo('oeste') ? 'block' : 'none'">
      <h3>Cuadrante Oeste</h3>
      <ion-grid class="cuadrante-grid">
        <ion-row>
          <ion-col size="6" size-md="6" size-lg="3" *ngFor="let modulo of getModulosOeste()">
            <ion-card class="modulo-card">
              <img [src]="modulo.estadoReset 
                        ? 'assets/img/version2.png' 
                        : 'assets/img/version1.png'"  
                    alt="Modulo"/>
              <ion-card-header>
                <div class="titulo-con-controles">
                  <ion-button 
                    fill="outline"
                    size="small" 
                    (click)="actualizarEstadoModulo(modulo.moduloId)"
                    class="boton-actualizar"
                    [disabled]="modulo.actualizandoEstado"
                    slot="icon-only">
                    F5
                  </ion-button>
                  <div class="titulo-central">
                    <ion-card-title>{{ modulo.nombre }}</ion-card-title>
                    <ion-card-subtitle>Versión: {{ modulo.version || 'V1' }}</ion-card-subtitle>
                  </div>
                  <div class="indicador-estado" 
                       [class.online]="getEstadoConexion(modulo.moduloId) === 'ONLINE'"
                       [class.offline]="getEstadoConexion(modulo.moduloId) === 'OFFLINE'"
                       [class.timeout]="getEstadoConexion(modulo.moduloId) === 'TIMEOUT'"
                       [class.desconocido]="getEstadoConexion(modulo.moduloId) === 'DESCONOCIDO'"
                       [attr.title]="getTituloEstado(modulo.moduloId)">
                    <ion-icon name="radio-button-on"></ion-icon>
                  </div>
                </div>
              </ion-card-header>
              <ion-card-content>
                <div class="card-body">
                  <div class="modulo-info-left">
                    <div class="info-item">
                      <div class="value">{{ modulo.medicionTempActual || 'N/A' }} °C</div>
                      <div class="value">{{ modulo.medicionPressActual || 'N/A' }} hPa</div>
                    </div>
                  </div>
                  <div class="mediciones-right">
                    <div class="modulo-item up" 
                      [class.activo]="modulo.estadoReset"
                      [class.correcto]="getEstadoApunte(modulo.moduloId, 'up') === 'correcto'"
                      [class.mismatch]="getEstadoApunte(modulo.moduloId, 'up') === 'mismatch'"
                      [class.desconectado]="getEstadoApunte(modulo.moduloId, 'up') === 'desconectado'">
                      <div class="medicion-container">
                        <span class="temperatura">UP: {{ modulo.up }}</span>
                      </div>
                    </div>
                    <div class="modulo-item down" 
                      [class.activo]="modulo.estadoReset"
                      [class.activo]="modulo.estadoReset"
                         [class.correcto]="getEstadoApunte(modulo.moduloId, 'down') === 'correcto'"
                         [class.mismatch]="getEstadoApunte(modulo.moduloId, 'down') === 'mismatch'"
                         [class.desconectado]="getEstadoApunte(modulo.moduloId, 'down') === 'desconectado'">
                      <div class="medicion-container">
                        <span class="temperatura">DW: {{ modulo.down }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="botones">
                  <ion-button fill="outline" size="small" 
                  (click)="verMediciones(modulo.moduloId)">
                    DATA
                  </ion-button>
                  <ion-button color="primary" size="small" 
                  (click)="verDetalle(modulo.moduloId)">
                    INFO
                  </ion-button>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>  
      </ion-grid>
    </div>

    <!-- CUADRANTE SUR -->
    <div class="cuadrante cuadrante-sur" 
    [class.cuadrante-activo]="esCuadranteActivo('sur')"
    [style.display]="esCuadranteActivo('sur') ? 'block' : 'none'">
      <h3>Cuadrante Sur</h3>
      <ion-grid class="cuadrante-grid">
        <ion-row>
          <ion-col size="6" size-md="6" size-lg="3" *ngFor="let modulo of getModulosSur()">
            <ion-card class="modulo-card">
              <img [src]="modulo.estadoReset 
                        ? 'assets/img/version2.png' 
                        : 'assets/img/version1.png'"  
                    alt="Modulo"/>
              <ion-card-header>
                <div class="titulo-con-controles">
                  <ion-button 
                    fill="outline"
                    size="small" 
                    (click)="actualizarEstadoModulo(modulo.moduloId)"
                    class="boton-actualizar"
                    [disabled]="modulo.actualizandoEstado"
                    slot="icon-only">
                    F5
                  </ion-button>
                  <div class="titulo-central">
                    <ion-card-title>{{ modulo.nombre }}</ion-card-title>
                    <ion-card-subtitle>Versión: {{ modulo.version || 'V1' }}</ion-card-subtitle>
                  </div>
                  <div class="indicador-estado" 
                       [class.online]="getEstadoConexion(modulo.moduloId) === 'ONLINE'"
                       [class.offline]="getEstadoConexion(modulo.moduloId) === 'OFFLINE'"
                       [class.timeout]="getEstadoConexion(modulo.moduloId) === 'TIMEOUT'"
                       [class.desconocido]="getEstadoConexion(modulo.moduloId) === 'DESCONOCIDO'"
                       [attr.title]="getTituloEstado(modulo.moduloId)">
                    <ion-icon name="radio-button-on"></ion-icon>
                  </div>
                </div>
              </ion-card-header>
              <ion-card-content>
                
                <div class="card-body">
                  <div class="modulo-info-left">
                    <div class="info-item">
                      <div class="value">{{ modulo.medicionTempActual || 'N/A' }} °C</div>
                      <div class="value">{{ modulo.medicionPressActual || 'N/A' }} hPa</div>
                    </div>
                  </div>
                  <div class="mediciones-right">
                    <div class="modulo-item up" 
                      [class.activo]="modulo.estadoReset"
                      [class.correcto]="getEstadoApunte(modulo.moduloId, 'up') === 'correcto'"
                         [class.mismatch]="getEstadoApunte(modulo.moduloId, 'up') === 'mismatch'"
                         [class.desconectado]="getEstadoApunte(modulo.moduloId, 'up') === 'desconectado'">
                      <div class="medicion-container">
                        <span class="temperatura">UP: {{ modulo.up }}</span>
                      </div>
                    </div>
                    <div class="modulo-item down" 
                      [class.activo]="modulo.estadoReset"
                      [class.correcto]="getEstadoApunte(modulo.moduloId, 'down') === 'correcto'"
                         [class.mismatch]="getEstadoApunte(modulo.moduloId, 'down') === 'mismatch'"
                         [class.desconectado]="getEstadoApunte(modulo.moduloId, 'down') === 'desconectado'">
                      <div class="medicion-container">
                        <span class="temperatura">DW: {{ modulo.down }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="botones">
                  <ion-button fill="outline" size="small" 
                  (click)="verMediciones(modulo.moduloId)">
                    DATA
                  </ion-button>
                  <ion-button color="primary" size="small" 
                  (click)="verDetalle(modulo.moduloId)">
                    INFO
                  </ion-button>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>  
      </ion-grid>
    </div>
  </div>

  <!-- Botones principales -->
  <div class="acciones-globales-bottom">
    <ion-button fill="solid" color="success" size="small" (click)="encenderTodos()">
      Encender Módulos
    </ion-button>
    <ion-button fill="solid" color="danger" size="small" (click)="apagarTodos()">
      Apagar Módulos
    </ion-button>
    <ion-button 
      fill="solid" 
      color="warning" 
      size="small" 
      (click)="actualizarEstadoTodos()"
      [disabled]="actualizandoEstadoGeneral">
      <ion-icon 
        [name]="actualizandoEstadoGeneral ? 'refresh' : 'pulse-outline'" 
        [class.spinning]="actualizandoEstadoGeneral"
        slot="start">
      </ion-icon>
      {{ actualizandoEstadoGeneral ? 'Actualizando...' : 'STATUS' }}
    </ion-button>
  </div>
</ion-content>