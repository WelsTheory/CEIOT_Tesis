# ===== Configuración Mosquitto con SSL/TLS =====

# ===== Puerto MQTT sin cifrar (1883) =====
# Mantener para compatibilidad local o dispositivos legacy
listener 1883
protocol mqtt
allow_anonymous true

# ===== Puerto MQTT con SSL/TLS (8883) =====
listener 8883
protocol mqtt

# Certificados SSL/TLS
cafile /mosquitto/config/certs/ca.crt
certfile /mosquitto/config/certs/server.crt
keyfile /mosquitto/config/certs/server.key

# No requerir certificado del cliente (más fácil para microcontroladores)
require_certificate false

# Versiones TLS permitidas (recomendado TLSv1.2 y TLSv1.3)
tls_version tlsv1.2

# Seguridad básica con autenticación
allow_anonymous false
password_file /mosquitto/config/passwd

# ===== Puerto WebSocket con SSL/TLS (8884) =====
listener 8884
protocol websockets

# Usar los mismos certificados
cafile /mosquitto/config/certs/ca.crt
certfile /mosquitto/config/certs/server.crt
keyfile /mosquitto/config/certs/server.key

require_certificate false
tls_version tlsv1.2
allow_anonymous false
password_file /mosquitto/config/passwd

# ===== Puerto WebSocket sin cifrar (9001) =====
# Para desarrollo local
listener 9001
protocol websockets
allow_anonymous true

# ===== Persistencia =====
persistence true
persistence_location /mosquitto/data/

# ===== Logging =====
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type all
log_timestamp true

# ===== Configuraciones adicionales de seguridad =====
# Limitar conexiones por IP
max_connections -1

# Timeout de conexión
keepalive_interval 60

# Tamaño máximo de mensaje (10 MB)
message_size_limit 10485760